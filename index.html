<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NIDAAN MATFLOW ‚Äì Ultra Premium</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap');

*{
  box-sizing:border-box;
  font-family:'Poppins',sans-serif;
}

body{
  margin:0;
  height:100vh;
  overflow:hidden;
  background:#fff3e0;
}

/* HEADER */
header{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  z-index:100;
  background:linear-gradient(135deg,#e65100,#ff6f00);
  text-align:center;
  padding:14px 16px;
  box-shadow:0 6px 20px rgba(0,0,0,0.25);
}

.title-main{
  font-size:22px;
  font-weight:800;
  color:#ffffff;
  letter-spacing:1px;
}

.title-sub{
  font-size:12px;
  font-style:italic;
  color:#ffe0b2;
  margin-top:2px;
}

#darkToggle{
  position:absolute;
  right:12px;
  top:12px;
  width:40px;
  height:40px;
  border-radius:50%;
  border:none;
  cursor:pointer;
  font-size:18px;
  background:rgba(0,0,0,0.25);
  color:#fff;
}

/* CHAT AREA */
.chat-area{
  position:absolute;
  top:82px;
  bottom:90px;
  left:0;
  right:0;
  padding:16px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:12px;
  background:#fff8f0;
  scroll-behavior:smooth;
}

/* MESSAGE */
.message{
  padding:14px 18px;
  border-radius:20px;
  max-width:85%;
  font-size:15px;
  line-height:1.6;
  animation:slideUp 0.3s ease;
}

@keyframes slideUp{
  from{transform:translateY(10px);opacity:0;}
  to{transform:translateY(0);opacity:1;}
}

.user{
  align-self:flex-end;
  background:#ffe0b2;
  color:#4e342e;
  box-shadow:0 6px 15px rgba(0,0,0,0.15);
}

.ai{
  align-self:flex-start;
  background:#ffffff;
  color:#333;
  box-shadow:0 6px 15px rgba(0,0,0,0.15);
}

/* FLOATING THINK "VALIDATING" */
.typing{
  align-self:flex-start;
  background:#fff3cd;
  color:#6d4c41;
  font-weight:600;
  animation:floating 1.6s ease-in-out infinite;
}

@keyframes floating{
  0%{transform:translateY(0)}
  50%{transform:translateY(-6px)}
  100%{transform:translateY(0)}
}

.time{
  font-size:11px;
  opacity:0.5;
  margin-top:4px;
  text-align:right;
}

/* FOOTER */
footer{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  z-index:100;
  display:flex;
  gap:10px;
  padding:12px;
  background:#ffffff;
  box-shadow:0 -4px 18px rgba(0,0,0,0.2);
}

input{
  flex:1;
  padding:14px 18px;
  font-size:14px;
  border-radius:25px;
  border:none;
  outline:none;
  background:#fff3e0;
}

button{
  width:46px;
  height:46px;
  border-radius:50%;
  border:none;
  font-size:18px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
}

#micBtn{
  background:linear-gradient(135deg,#ff8f00,#ff6f00);
  color:#fff;
}

#sendBtn{
  background:linear-gradient(135deg,#ff5722,#ff9800);
  color:#fff;
}

/* DARK MODE */
body.dark{
  background:#121212;
}

body.dark .chat-area{
  background:#1e1e1e;
}

body.dark footer{
  background:#000;
}

body.dark input{
  background:#2c2c2c;
  color:#fff;
}

body.dark .ai{
  background:#2a2a2a;
  color:#fff3e0;
}

body.dark .user{
  background:#ffcc80;
  color:#000;
}
</style>
</head>

<body>

<header>
  <div class="title-main">NIDAAN MATFLOW</div>
  <div class="title-sub">(Your AI Partner for Material Management)</div>
  <button id="darkToggle">üåô</button>
</header>

<div class="chat-area" id="chatArea">
  <div class="message ai">
    Hello üëã I‚Äôm <b>NIDAAN MATFLOW</b> ‚Äî Your intelligent material assistant. How may I help you?
    <div class="time"></div>
  </div>
</div>

<footer>
  <input id="userInput" type="text" placeholder="Type your query..." autocomplete="off">
  <button id="micBtn">üé§</button>
  <button id="sendBtn">‚û§</button>
</footer>

<script>
const input = document.getElementById("userInput");
const chat = document.getElementById("chatArea");
const sendBtn = document.getElementById("sendBtn");
const micBtn = document.getElementById("micBtn");
const darkToggle = document.getElementById("darkToggle");

const WEBHOOK_URL = "https://n8n-oazxlbnc.us-west-1.clawcloudrun.com/webhook/67a36a49-2506-4bc3-a1b4-0046fa8d5901";

darkToggle.onclick = () => {
  document.body.classList.toggle("dark");
  darkToggle.textContent = document.body.classList.contains("dark") ? "‚òÄ" : "üåô";
};

function now(){
  return new Date().toLocaleTimeString([], { hour:'2-digit', minute:'2-digit' });
}

function scrollBottom(){
  chat.scrollTop = chat.scrollHeight;
}

sendBtn.onclick = sendMessage;
input.addEventListener("keydown", e => {
  if(e.key === "Enter") sendMessage();
});

function sendMessage(){
  const text = input.value.trim();
  if(!text) return;

  const user = document.createElement("div");
  user.className = "message user";
  user.innerHTML = `${text}<div class="time">${now()}</div>`;
  chat.appendChild(user);
  input.value = "";
  scrollBottom();

  const typing = document.createElement("div");
  typing.className = "message ai typing";
  typing.innerHTML = "NIDAAN is validating material records‚Ä¶";
  chat.appendChild(typing);
  scrollBottom();

  fetch(WEBHOOK_URL, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ message: text })
  })
  .then(res => res.json())
  .then(data => {
    typing.remove();
    const reply = data.reply || data.output || data.text || JSON.stringify(data);
    const ai = document.createElement("div");
    ai.className = "message ai";
    ai.innerHTML = `${reply}<div class="time">${now()}</div>`;
    chat.appendChild(ai);
    scrollBottom();
  })
  .catch(() => {
    typing.remove();
    const ai = document.createElement("div");
    ai.className = "message ai";
    ai.innerHTML = `‚ö†Ô∏è Server not reachable<div class="time">${now()}</div>`;
    chat.appendChild(ai);
    scrollBottom();
  });
}
</script>

</body>
</html>
